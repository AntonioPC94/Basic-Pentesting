# Máquina: Basic Pentesting

**Tryhackme: Basic Pentesting**

Lo primero que haremos, será lanzar un NMAP para ver qué puertos tiene abiertos la máquina:

![BSICPNTST1](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST1.png)

Como observamos en la imagen anterior, tenemos cuatro puertos abiertos. A continuación, vamos a empezar a enumerar todo lo que podamos sobre cada uno de ellos.

Primero nos enfocaremos en el puerto 80, así que vamos a usar la herramienta Dirbuster sobre dicho puerto para buscar ficheros y directorios ocultos.

![BSICPNTST2](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST2.png)

Como se observa en la imagen anterior, existen dos rutas que llevan a un fichero de texto distinto, dichos ficheros podrían ser interesantes de analizar.

A continuación, vamos a intentar acceder a ellos para ver qué información contienen.

Contenido del fichero "/development/dev.txt":

![BSICPNTST3](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST3.png)

En la imagen anterior se observan varios mensajes escritos por dos personas. Entre ellos se habla sobre una web y que la versión de la misma es la 2.5.12. También hay un mensaje que tanto SMB, como Apache están configurados y listos para usar, habrá que echar un vistazo a esos dos servicios.

Y no sabemos si tendrá algo que ver o no, pero "-K" y "-J" podrían ser las iniciales de estas personas.

Nota: REST es una arquitectura de software que impone condiciones sobre cómo debe funcionar una API.

Contenido del fichero "/development/j.txt":

![BSICPNTST5](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST5.png)

En la imagen anterior se observa un mensaje escrito por la misma persona que escribió varios de los mensajes encontrados anteriormente, diciéndole a "J", que ha conseguido crackear el hash de su contraseña, ya que esta es demasiado fácil.

Posiblemente "ASAP" tenga algo que ver con la contraseña de J.

Bien, ahora vamos a enumerar el puerto 139, que es el que corre el servicio SAMBA, servicio del que estuvieron hablando los usuarios anteriormente mencionados.

Lo primero que haremos, será lanzar un módulo de Metasploit, el cual nos va a indicar la versión del servicio que está corriendo en dicho puerto:

- Módulo empleado: auxiliary(scanner/smb/smb_version)

![BSICPNTST6](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST6.png)

Una vez hayamos descubierto la versión, vamos a intentar conectarnos al servicio, a ver si conseguimos encontrar algo de información.

Antes que nada, vamos a listar los recursos que hay compartidos en el servidor Samba de la máquina objetivo:

![BSICPNTST7](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST7.png)

Como observamos en la imagen anterior, existen dos recursos compartidos. Vamos a intentar acceder primero al recurso "IPC$".

Las credenciales de acceso que vamos a usar, son:

- Usuario: J
- Pass: ASAP

![BSICPNTST8](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST8.png)

A continuación, si listamos el contenido del recurso, comprobaremos que este está vacío:

![BSICPNTST9](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST9.png)

Ahora nos iremos al recurso "Anonymous", para ver si hay algo dentro de él:

![BSICPNTST10](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST10.png)

Realizando el mismo proceso que hicimos para acceder al contenido del recurso "IPC$", nos encontramos con un fichero de texto llamado "staff.txt".

Como este parece ser interesante, nos lo vamos a llevar a nuestra máquina realizando el siguiente comando:

![BSICPNTST11](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST11.png)

A continuación, vamos a usar "cat" para listar el contenido del fichero:

![BSICPNTST12](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST12.png)

Como se observa en la imagen anterior, vemos que existen al menos dos usuarios en el sistema que estamos atacando: Jan y Kay.

Ahora que tenemos un par de usuarios del sistema, vamos a intentar realizar fuerza bruta con Hydra para ver si podemos sacar alguna contraseña:

![BSICPNTST13](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST13.png)

Tras pasar un breve periodo de tiempo, Hydra nos devolverá la contraseña del usuario, la cual es "armando".

![BSICPNTST16](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST16.png)

Ahora que sabemos cuáles son las credenciales del usuario "jan", vamos a intentar acceder a la máquina a través del puerto 22.

![BSICPNTST14](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST14.png)

Una vez puestas las credenciales, estaremos dentro de la máquina logeados como "jan".

![BSICPNTST15](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST5.png)

Dentro del directorio "jan" situado en su "/home", nos encontramos con un fichero oculto llamado ".lesshst", sobre el cual no teníamos permiso de ningún tipo. Entonces, decidimos retroceder un directorio para poder buscar más información.

Haciendo otro listado de ficheros y directorios ocultos, nos encontramos con un directorio llamado "kay", al cual si teníamos permisos para poder acceder.

Una vez dentro de dicho fichero, listamos de nuevo todos los ficheros y directorios ocultos y ahí si que encontramos varias cosas interesantes:

![BSICPNTST17](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST17.png)

El primer fichero señalado en la imagen anterior, posiblemente contenga algún tipo de información importante, pero nosotros como usuario Jan, no podemos ver ni siquiera su contenido, ya que no tenemos permisos. Lo que si sabemos, es que Kay es el propietario de dicho archivo.

Por lo tanto, vamos a buscar la manera de acceder como dicho usuario para poder ver así el contenido de dicho fichero.

El segundo fichero señalado en la imagen anterior, contenía los siguientes ficheros:

![BSICPNTST18](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST18.png)

Como vemos, en la imagen anterior aparece la clave pública y la clave privada del usuario Kay. Así que, vamos a intentar conectarnos por SSH al usuario Kay utilizando su clave privada, a ver si hay suerte.

![BSICPNTST19](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST19.png)

En la imagen anterior, vemos que nos encontraremos con un pequeño problema y es que no podremos acceder a menos de que pongamos la "Passphrase" de dicho usuario.
 
Como no la sabemos, vamos a intentar primero sacar el hash de la clave privada de Kay con "ssh2john" para luego romperla con John The Ripper.

![BSICPNTST20](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST20.png)

![BSICPNTST21](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST21.png)

Ahora que sabemos cuál es la "Passphrase" del usuario Kay, vamos a acceder al sistema por SSH y vamos a listar el contenido del fichero.

![BSICPNTST22](https://github.com/AntonioPC94/Basic-Pentesting/blob/49e8f1d88fe89df84c54f29369e613baad57dd90/img/BSICPNTST22.png)

